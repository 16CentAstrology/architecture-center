---
title: AKS triageâ€”Workload deployments
titleSuffix: Azure Architecture Center
description: Learn how to check whether workload deployments and daemonSets are running as part of triage practices in an AKS cluster.
author: paolosalvatori
ms.author: paolos
ms.date: 11/15/2023
ms.topic: conceptual
ms.service: architecture-center
ms.subservice: azure-guide
azureCategories: compute
categories: compute
products:
  - azure-kubernetes-service
ms.custom:
  - e2e-aks
---

# Monitor the workload deployments

_This article is part of a series. Start with the [overview](aks-triage-practices.md)._

It's crucial to monitor the health and performance of your Kubernetes workloads to ensure that they are running optimally. Azure Kubernetes Service (AKS) provides several tools and methods to check the health and performance of your deployments, daemonsets, and services. This article describes these tools and approaches.

## Tools

It's important to know if all deployments and daemonSets are running. The following sections describe how to validate if the **Ready** and the **Available** matches the expected count by using:  

- The Azure portal  
- The Container insights feature of Azure Monitor  
- The Kubectl command line tool  
- Prometheus and Grafana

### Azure portal

You can use the Azure portal to verify the health of the following with regard to your workloads. For more information, see [Access Kubernetes resources from the Azure portal](/azure/aks/kubernetes-portal).

#### Deployments, replicasets, statefulsets, and daemonsets

Check that the number of replicas in a `Ready` state matches the number of desired replicas. The portal shows:

- The number of replicas that are currently available and ready to serve traffic. These replicas have been successfully scheduled onto worker nodes, have completed their startup process, and have passed their readiness checks.

- The desired number of replicas specified for the deployment. This is the number of replicas that the deployment aims to maintain. The Kubernetes deployment controller constantly monitors the state of the deployment and tries to ensure that the actual number of replicas matches the desired number.

#### Services and ingresses

Ensure that the status is `Ok` for all services and ingresses.

#### Storage

Ensure that the status is `BOUND` for all the persistent volume claims and persistent volumes.

### Container insights

[Container insights](/azure/azure-monitor/containers/container-insights-overview) is a feature of [Azure Monitor](/azure/azure-monitor/overview) that provides monitoring capabilities for container workloads deployed to AKS or managed by [Azure Arc-enabled Kubernetes](/azure/azure-arc/kubernetes/overview). This feature gathers performance and health information by collecting memory and processor metrics from controllers, nodes, and containers. It also captures container logs for analysis.

You can analyze the collected data by using various views and pre-built workbooks. Use these tools to examine the performance and behavior of the various components within your cluster. With Container insights, you can gain valuable insights into the overall state of your container workloads and make informed decisions to optimize their performance and troubleshoot issues.

You can use the following capabilities of Container insights to understand the performance and health of your Kubernetes cluster and container workloads:

- Identify resource bottlenecks by identifying containers that run on each node and their processor and memory utilization.

- Identify processor and memory utilization of container groups and their containers hosted in container instances.
- View the controller's or pod's overall performance by identifying where the container resides in a controller or a pod.
- Review the resource utilization of workloads running on the host that are unrelated to the standard processes that support the pod.
- Identify capacity needs and determine the maximum load that the cluster can sustain by understanding the behavior of the cluster under average and heaviest loads.
- Access live container logs and metrics generated by the container engine to help with troubleshooting issues in real time.
- Configure alerts to proactively notify you or record when CPU and memory utilization on nodes or containers exceed your thresholds, or when a health state change occurs in the cluster at the infrastructure or nodes health rollup.

In the Azure portal, Container insights provides several tabs to help monitor and analyze an AKS cluster's health and performance. Here is a brief explanation of each tab:

- **Cluster**: This tab provides an overtab of your AKS cluster, including key metrics like CPU and memory utilization, pod and node counts, and network traffic. It gives you insights into the overall health and resource utilization of the cluster.

- **Reports**: The Reports tab offers pre-built reports that allow you to visualize and analyze various aspects of your cluster's performance, such as resource utilization, pod health, and container insights. These reports provide valuable information to understand the behavior and performance of your containers and workloads.
- **Nodes**: The Nodes tab displays detailed information about the nodes in your cluster. It provides metrics for CPU and memory usage, disk and network I/O, as well as the condition and status of each node. This tab helps you monitor individual node performance, identify potential bottlenecks, and ensure efficient resource allocation.
- **Controllers**: The Controllers tab provides visibility into the Kubernetes controllers in your AKS cluster. It shows information such as the number of controller instances, the current state, and the status of controller operations. This tab helps you monitor the health and performance of controllers responsible for managing workload deployments, services, and other resources.
- **Containers**: The Containers tab gives you insights into the individual containers running in your AKS cluster. It provides information related to resource usage, restarts, and lifecycle events of each container. This tab helps you monitor and troubleshoot specific containers within your workloads.

Additionally, Container insights in AKS provides [live logs](/azure/azure-monitor/containers/container-insights-livedata-metrics) functionality. This feature allows you to view container logs in real-time, providing a live stream of log events from running containers. This helps you monitor and troubleshoot applications more effectively, enabling faster identification and resolution of any issues occurring within your containers.

For more information, see:

- [Monitor your Kubernetes cluster performance with Container insights](/azure/azure-monitor/containers/container-insights-analyze)
- [Configure GPU monitoring with Container insights](/azure/azure-monitor/containers/container-insights-gpu-monitoring)
- [Monitor and visualize network configurations with Azure NPM](/azure/virtual-network/kubernetes-network-policies?toc=/azure/azure-monitor/toc.json#monitor-and-visualize-network-configurations-with-azure-npm)
- [Monitor deployments and HPA metrics with Container insights](/azure/azure-monitor/containers/container-insights-deployment-hpa-metrics)
- [Monitor Persistent Volumes (PVs)](/azure/azure-monitor/containers/container-insights-persistent-volumes)
- [Monitor Security with Syslog](/azure/azure-monitor/containers/container-insights-syslog)
- [Reports in Container insights](/azure/azure-monitor/containers/container-insights-reports)
- [Metrics collected by Container insights](/azure/azure-monitor/containers/container-insights-custom-metrics)
- [View Kubernetes logs, events, and pod metrics in real time](/azure/azure-monitor/containers/container-insights-livedata-overview)
- [View cluster metrics in real time](/azure/azure-monitor/containers/container-insights-livedata-metrics)

### Kubectl command line tool

You can use the `kubectl` command line tool to communicate with a Kubernetes cluster's control plane, using the Kubernetes API, and check the status of your workloads.

#### Pods

You can run the following command to list all the pods running in all namespaces:

```console
kubectl get pod -A
```

The `READY` column provides important information about the readiness state of the pod's containers.

- The first number signifies the count of containers that are currently in a ready state. This means these containers have passed the readiness probes and are prepared to handle incoming traffic.

- The second number represents the total count of containers that are defined within the pod, regardless of their readiness state. It includes both containers that are ready and those that are still initializing or experiencing issues.

Ensure that the first number (ready containers) matches the second number (total containers) for the pod. If they differ, it indicates that some containers might not be ready or that there might be issues preventing them from reaching the ready state.

#### Deployments, StatefulSets, DaemonSets, and StatefulSets

Run the following command to retrieve the [Deployments](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/) in all namespaces:

```console
kubectl get deploy -A
```

The numbers under the `READY` column in the result of the `kubectl get deployment` command indicate the current readiness state of the replicas in a deployment.

- The first number represents the number of replicas that are ready and available to serve traffic. These replicas have successfully started and passed their readiness checks.

- The second number represents the desired number of replicas specified in the deployment configuration. It's the target number of replicas that the deployment aims to maintain.

It's important to ensure that the first number matches the second number. It indicates that the desired number of replicas are running and ready. Any discrepancy between the two numbers might indicate scaling or readiness issues to address.

Run the following command to repeat the same check for [StatefulSets](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset):

```console
kubectl get statefulset -A
```

Run the following command to get the [DaemonSets](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) in all namespaces:

```console
kubectl get ds -A
```

You can run a `kubectl get ds` command to check that a specific DaemonSet is running as expected. For example, you can run the following command to verify that the Container insights agent is deployed successfully.

```console
kubectl get ds ama-logs --namespace=kube-system
```

Likewise, if you configured your AKS cluster to collect Prometheus metrics to [Azure Monitor for managed Prometheus](/azure/azure-monitor/containers/prometheus-metrics-enable), you can run the following command to verify that the DaemonSet was deployed properly on the Linux node pools:

```console
kubectl get ds ama-metrics-node --namespace=kube-system
```

This output provides you with information about the DaemonSets in your cluster. Examine the output to ensure that the number of pods in the `READY`, `CURRENT`, and `DESIRED` states are the same. This means that the desired number of pods specified in the DaemonSet configuration is equal to the number of pods that are currently running and ready.

We recommended that you perform the same check for [ReplicaSets](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset). You can use the following command to list all the ReplicaSets in all namespaces.

```console
kubectl get rs -A
```

Compare the numbers in this output to ensure that the intended number of pods or replicas are running as expected. Discrepancies might indicate a need for further investigation or troubleshooting by using the following commands.

- [kubectl describe](https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods): You can use the `kubectl describe` command to get detailed information about Kubernetes resources, such as pods, deployments, and services. Get a comprehensive overview of the specified resource, including its current state, events, conditions, and related metadata. The information is retrieved from the Kubernetes API server and is useful for troubleshooting or understanding the status of a resource.

  For example, you can run `kubectl describe pod <pod-name>` to get detailed information about a specific pod, including its current state, events, labels, and the containers that are associated with it. The output shows information like pod status, events, volumes, and conditions.

- [kubectl logs](https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods): You can use the `kubectl logs` command to retrieve logs that are generated by a specific container within a pod. It's helpful for debugging and troubleshooting. You can view the logs in real-time or retrieve historical logs from a specific container. To view container logs, you can use the `command kubectl logs <pod-name> -c <container-name>`. `<pod-name>` is the name of the pod. `<container-name>` is the name of the container from which you want to fetch the logs. If there's only one container within the pod, you don't need to specify the container name. Additionally, you can use the `-f` flag with `kubectl logs` to follow the logs in real time, similar to the `tail -f` Linux command.
- [kubectl events](https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods): You can use the `kubectl events` command for troubleshooting when a Deployment, DaemonSet, ReplicaSet, or Pod hasn't started or encountered issues during startup. This command provides a chronological list of events associated with the specified resource. It provides insights into what might have caused the problem.

  To use `kubectl events`, you can run the command `kubectl events` followed by a specific resource name or use selectors to filter events based on labels, namespaces, or other criteria. For example, to retrieve events related to a specific pod, you can run `kubectl events --field-selector involvedObject.name=<pod-name> --field-selector involvedObject.kind=Pod`. Replace `<pod-name>` with the name of the pod you want to investigate. The output of the `kubectl events` command displays information such as the event type (normal or warning), event message, reason for the event, and the time stamp when the event occurred. This information can provide clues about what caused the failure or issue during startup.

  If you suspect that a specific resource like a Deployment, DaemonSet, or ReplicaSet is experiencing problems, you can filter events using selectors accordingly. For example, `kubectl events --field-selector involvedObject.name=<deployment-name> --field-selector involvedObject.kind=Deployment` shows events related to a specific deployment. By examining the events, you can gather important details about potential errors, failures, or other events that might have prevented the resource from starting properly. This can assist you in troubleshooting and resolving the issues affecting the deployment, DaemonSet, ReplicaSet, or pod.

### In-cluster monitoring with Prometheus and Grafana

If you deployed [Prometheus](https://prometheus.io) and [Grafana](https://grafana.com) in your AKS cluster for monitoring and visualization, you can use the [K8 cluster detail dashboard](https://grafana.com/grafana/dashboards/10856-k8-cluster) to gain valuable insights. This dashboard leverages the Prometheus cluster metrics to present vital information such as CPU usage, memory utilization, network activity, file system usage, as well as detailed statistics for individual pods, containers, and systemd services. To ensure the health and performance of your deployments, jobs, pods, and containers, you can use the corresponding blades in the dashboard. The panels under the `Deployments` section show the number of replicas for each deployment, the total number of replicas, while the panels under the `Containers` section show a chart for running, pending, failed, and succeeded containers.

### Azure Monitor-managed service for Prometheus and Azure-managed Grafana

If you set up your AKS cluster to collect Prometheus metrics to [Azure Monitor-managed service for Prometheus](/azure/azure-monitor/essentials/prometheus-metrics-overview) and connect your [Azure Monitor workspace](/azure/azure-monitor/essentials/azure-monitor-workspace-manage#link-a-grafana-workspace) to an [Azure-managed Grafana](/azure/managed-grafana/overview) workspace, you can take advantage of pre-built dashboards to visualize and analyze Prometheus metrics.

These dashboards, which are available in a [GitHub repository](https://aka.ms/azureprometheus-mixins) and can be installed by following the [installation instructions](https://github.com/Azure/prometheus-collector/tree/main/mixins/kubernetes#how-to-use), provide a comprehensive view of your Kubernetes cluster's performance and health. They are provisioned in the specified Azure Grafana instance under the `Managed Prometheus` folder.

- `Kubernetes / Compute Resources / Cluster`
- `Kubernetes / Compute Resources / Namespace (Pods)`
- `Kubernetes / Compute Resources / Node (Pods)`
- `Kubernetes / Compute Resources / Pod`
- `Kubernetes / Compute Resources / Namespace (Workloads)`
- `Kubernetes / Compute Resources / Workload`
- `Kubernetes / Kubelet`
- `Node Exporter / USE Method / Node`
- `Node Exporter / Nodes`
- `Kubernetes / Compute Resources / Cluster (Windows)`
- `Kubernetes / Compute Resources / Namespace (Windows)`
- `Kubernetes / Compute Resources / Pod (Windows)`
- `Kubernetes / USE Method / Cluster (Windows)`
- `Kubernetes / USE Method / Node (Windows)`

These built-in dashboards are widely used in the open-source community for monitoring Kubernetes clusters with Prometheus and Grafana. They offer valuable insights into metrics such as resource utilization, pod health, and network activity. Additionally, you can create custom dashboards tailored to your specific monitoring needs. Use these dashboards to effectively monitor and analyze Prometheus metrics in your AKS cluster. You can optimize performance, troubleshoot issues, and ensure the smooth operation of your Kubernetes workloads.

To visualize the CPU usage, CPU quota, memory usage, and memory quota by pod in your Linux agent nodes, you can use the `Kubernetes / Compute Resources / Node (Pods)` dashboard. The `Kubernetes / Compute Resources / Pod` Grafana dashboard provides comprehensive insights into the resource consumption and performance metrics of a selected cluster, namespace, and pod. This dashboard allows you to analyze crucial metrics related to CPU usage, CPU throttling, CPU quota, memory usage, memory quota, networking metrics, and storage metrics. The dashboard allows you to select an AKS cluster, namespace, and specific pod within the chosen namespace and provides the following panels:

- `CPU Usage`: This chart displays the CPU usage of the selected pod over time. It helps you understand the CPU consumption pattern and identify potential spikes or abnormalities.

- `CPU Throttling`: This chart provides insights into CPU throttling, which occurs when a pod exceeds its CPU resource limits. Monitoring this metric helps you identify situations where the pod's performance is being restricted due to CPU throttling.
- `CPU Quota`: This chart showcases the allocated CPU quota for the selected pod. It allows you to observe if the pod is exceeding its assigned CPU quota and potentially requiring resource adjustments.
- `Memory Usage`: This chart presents the memory usage of the selected pod, allowing you to monitor the memory consumption pattern and identify any memory-related issues.
- `Memory Quota`: This chart displays the allocated memory quota for the pod. You can observe if the pod is exceeding its assigned memory quota, which might indicate a need for resource optimization.
- `Networking Metrics`: This section includes charts for received and transmitted bandwidth, as well as the rate of received and transmitted packets. These metrics help you monitor network usage and detect any potential networking bottlenecks or anomalies.
- `Storage Metrics`: This section provides information on storage-related metrics, such as input/output operations per second (IOPS) and throughput. Monitoring these metrics helps you gauge the performance and efficiency of the storage used by the pod.

By leveraging the `Kubernetes / Compute Resources / Pod` Grafana dashboard, you can gain valuable insights into the resource utilization, performance, and behavior of individual pods within your Kubernetes cluster. This allows you to optimize resource allocation, troubleshoot performance issues, and make informed decisions to ensure the smooth operation of your containerized workloads.

## Contributors

*This article is maintained by Microsoft. It was originally written by the following contributors.*

Principal author:

- [Paolo Salvatori](https://www.linkedin.com/in/paolo-salvatori) | Principal Customer Engineer

Other contributors:

- [Kevin Harris](https://www.linkedin.com/in/kevbhar) | Principal Solution Specialist
- [Francis Simy Nazareth](https://www.linkedin.com/in/francis-simy-nazereth-971440a) | Senior Technical Specialist

*To see non-public LinkedIn profiles, sign in to LinkedIn.*

## Next steps

- [Virtual machine disk limits](/azure/azure-resource-manager/management/azure-subscription-service-limits#virtual-machine-disk-limits)
- [Relationship between virtual machines and disk performance](/azure/virtual-machines/linux/disk-performance-linux)

## Related resources

> [!div class="nextstepaction"]
> [Validate the admission controllers](aks-triage-controllers.md)

# Azure Active Directory Reference Architecture for Security Operations
## Identity, meet Security Operations; your neighbor across the hall

Traditionally, when talking about security operations with an organization, network security dominated the conversation. This made sense when users were using services and devices managed by the organization and contained on a managed network.

As users interact with more cloud services, and as more organizations move to a [zero trust security model](https://www.microsoft.com/en-us/security/business/zero-trust), there has been a shift toward treating [user identity as the primary security boundary](https://docs.microsoft.com/en-us/azure/security/fundamentals/identity-management-best-practices).

Like two shy neighbors, Identity teams and Security Operations teams have not always had a close relationship. It is time to change that. This document will show you how to use the Azure AD platform in the context of security operations to take advantage of the highest possible protect, detect, and respond capabilities available today.
Through 2022, Gartner [predicts](https://www.gartner.com/en/newsroom/press-releases/2019-04-02-gartner-forecasts-worldwide-public-cloud-revenue-to-g) that the market size and growth of the cloud services industry will grow at a rate nearly three time that of overall IT services.

According to Verizon [2019 data breach investigations report](https://enterprise.verizon.com/resources/reports/dbir/?cmp=paid_search:bing:ves_us:gm:awareness&utm_medium=paid_search&utm_source=bing&utm_campaign=ves_us&utm_content=gm&utm_term=awareness&gclid=CLnp-ujPi-kCFQw6fwodhE8CEw&gclsrc=ds), 32% of breaches involved phishing and 29% involved use of stolen credentials. As per [Microsoft security intelligence report 2019](https://www.microsoft.com/security/blog/2019/02/28/microsoft-security-intelligence-report-volume-24-is-now-available/), between January and December 2018 phishing attacks increased by a margin of 250%.

These data breaches can be costly. According to a recent [study of data breach incidents](https://www.all-about-security.de/fileadmin/micropages/Fachartikel_28/2019_Cost_of_a_Data_Breach_Report_final.pdf), the average global cost of a data breach was $3.92M dollars, with the US average cost closer to $8.2M. As more companies embrace cloud computing, securing identities in the cloud must remain a high priority.

One approach proposed by Gartner is the [concept of an adaptive security architecture](https://www.gartner.com/en/documents/3913561/shift-from-managing-risk-and-security-to-enabling-value-), implementing “adaptive access protection” that combines “access, behavioral monitoring, usage management and discovery with continuous monitoring and analytical capabilities.” This architecture helps advance that approach.

## How to use this document
-	Design a new solution 
-	Enhance your existing implementation
-	Train your security operations team

## Architecture
Microsoft has built this [reference architecture](https://gallery.technet.microsoft.com/Cybersecurity-Reference-883fb54c) to show a recommended architecture for cloud and hybrid environments that use the Azure Active Directory Premium workload as their Identity-as-a-Service (IDaaS) component. We have tried to keep the terminology simple for those who are new to the platform; this should make it easier to understand some of the key security capabilities of Azure AD and other Microsoft security workloads.
![Screenshot shows the architecture discussed in this artcle](architecure.png)

The following sections explain each component mentioned in the above architecture. 

1. [Credential management](https://docs.microsoft.com/en-us/azure/active-directory/authentication/index) – The umbrella of credential management includes any service, policy or practice used to issue, track and update access to resources or services. This includes capabilities like [passwordless authentication](https://www.microsoft.com/en-us/security/business/identity/passwordless), [self-service password reset (SSPR)](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-sspr-howitworks), [banned password lists](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad), and [smart lockout](https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-password-smart-lockout). 

-	[Passwordless authentication](https://www.microsoft.com/en-us/security/business/identity/passwordless) – Adding options like multi-factor authentication to your credential management strategy, while useful in enhancing security, can sometimes frustrate end users. Also, end users can struggle with remembering complex or hard to remember passwords. Passwordless authentication experiences take the password out of the authentication workflow and replace it with something the user has - like a smartphone or hardware token and something that the users is or knows like biometric identifiers or a PIN number.

    Microsoft provides passwordless authentication options that can work with Azure resources by leveraging [Windows hello for business](https://docs.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/hello-identity-verification), and the [Microsoft authenticator app](https://www.microsoft.com/en-us/account/authenticator) on mobile devices. Microsoft also has preview support available for organizations who want to enable passwordless authentication experiences for their users [using FIDO2 compatible security keys](https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-authentication-passwordless-security-key). FIDO2 compatible keys leverage WebAuthn and the [FIDO alliance’s Client-to-Authenticator (CTAP) protocol](https://fidoalliance.org/specifications/download/) to authenticate users.

- [Self-service password reset (SSPR)](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-sspr-howitworks) – Users have multiple accounts and are expected to have complex passwords for each account. Users tend to forget their passwords and enabling users self-serve to reset their password is a feature that can reduce number of helpdesks calls and provide users flexibility and security. Azure AD also provides [Password Writeback](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-sspr-writeback) feature which allows password changed in cloud to sync with on-premises directory in real time.

- [Banned password list](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad) – Asking users to choose a unique and complex password is one way to help mitigate risk in your environment. Azure AD password protection analyzes telemetry data exposing commonly used weak or compromised passwords, and then bans their use globally throughout Azure AD. In addition to the global banned password lists, you should customize this functionality for your environment by including a list of [custom passwords](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad#custom-banned-password-list) that you want to ban within your own organization.

- [Smart lockout](https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-password-smart-lockout) – This feature compares authentication attempts from legitimate users with those of other users attempting to brute-force guess user credentials to gain access. With smart lockout enabled, under the default policy an account will lockout for one minute after 10 failed sign-in attempts. As sign-in attempts continue to fail, the account lockout time increases. Policies can be used to adjust the settings to get the appropriate mix of security and usability for your organization.

2.	Provisioning and Assignment to resources: Azure AD [entitlement management](https://docs.microsoft.com/en-us/azure/active-directory/governance/entitlement-management-overview) is one [Azure AD Identity Governance](https://docs.microsoft.com/en-us/azure/active-directory/governance/identity-governance-overview) feature that enables organizations to manage identity and access lifecycle at scale, by automating access request workflows, access assignments, reviews, and expiration. The [provisioning service](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/user-provisioning) enables you to automatically create user identities and roles in the applications that users need access to. [Azure AD provisioning](https://docs.microsoft.com/en-us/azure/active-directory/app-provisioning/how-provisioning-works) can also be configured to perform inbound user provisioning from [SuccessFactors](https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/sap-successfactors-inbound-provisioning-tutorial), [Workday](https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/workday-inbound-tutorial), and many [other third-party software as a service applications](https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/tutorial-list). 

    Azure AD allows you to configure [Azure Active Directory seamless single sign-on](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso) (Azure AD Seamless SSO) so that users are automatically authenticated to other cloud based applications once they have logged in to their corporate device. Azure AD Seamless SSO can be used with either [Password hash synchronization](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization) or [Pass-through authentication](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta).

3. [Access policy](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/concept-conditional-access-policies) and [Authorization engine](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/troubleshoot-conditional-access-what-if): A Conditional access policy is an if-then statement of assignments and access controls, bringing signals together to make decisions and enforce organizational policies.

4. Attestation: [Azure AD access reviews](https://docs.microsoft.com/en-us/azure/active-directory/governance/access-reviews-overview), identity governance and entitlement management work together to help organizations mitigate risk and meet monitoring and auditing requirements. By creating access reviews, you can quickly identify things like the number of users with admin roles, report on access for new employees to make sure they can access needed resources, and reviewing user’s access on a regular basis to determine if continued access is necessary.

5. [Risk detections](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-risk-events): Azure AD uses adaptive machine learning algorithms and heuristics to detect suspicious actions that are related to your user accounts. Each detected suspicious action is stored in a record called a risk detection. User and sign-in risk probability are calculated using this data along with Microsoft’s internal and external threat intelligence sources and signals.

   [Azure identity protection](https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/) includes several default policies that can be enabled to help your organization manage your response to suspicious actions being taken by your users. User risk is the probability that a user identity is compromised, while sign-in risk is the probability that a sign-in request isn’t coming from the user. 

   Azure AD calculates sign-in risk scores based on the probability of the sign-in request originating from the actual user based on behavioral analytics. 

6. [Controls](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/controls): With [Azure AD conditional access](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-conditional-access-azure-portal), you can control how authorized users access your apps. In a conditional access policy, you define the response ("if this") to the reason for triggering your policy ("then do this").

   All the controls can work in conjunction with your conditional access policies to help enforce organizational policy. Coupling conditional access controls with conditions for access you can create additional security controls only when necessary. As a typical example, you may want to allow users access to resources using single sign-on for users who are on a domain-joined device, while requiring MFA controls for users off network or on their own devices.

   The conditional access controls with Azure AD allow you to implement security based on factors detected at the time of request for access rather than requiring a one-size fits all approach.

- Multi-factor authentication (MFA): MFA helps protect access to your data and resources by requiring multiple forms of authentication when users attempt to access protected resources. Most users are familiar with having something that they know – like a password when accessing resources. MFA asks users to also demonstrate something that they have – like access to a trusted device or something that they are  - like a biometric identifier.
 
  [Azure multi-factor authentication](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks) allows you to configure what authentication types are available to users and then use those controls in a conditional access policy. Azure MFA allows you to use a variety of [authentication methods](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-authentication-methods) like phone calls, text messages, or [notification through the Authenticator app](https://www.microsoft.com/en-us/account/authenticator). 


- [Privileged identity management (PIM)](https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/): PIM provides you with a way to add additional monitoring and protection to administrative accounts and Azure AD resources and services. 

  [Azure Active Directory PIM](https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure) will allow you to manage and control access to resources within Azure, Azure AD, and other M365 services. PIM can provide just-in-time access to all your M365 services and resources, a history of administrative activations, a change log, and alerts that notify you when administrators are added or removed from roles you define. You can also choose to [require approval](https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-resource-roles-configure-role-settings) for activation of your administrative roles and whether you want to force users to provide justification for role requests.

  With PIM, users can instead maintain normal privileges most of the time. When they need to perform an administrative task, they make a request for access to the role that they need to complete their work. Once users have completed their work and logged out – or the time limit on their request has expired, their session will end, and they will be re-authenticated with their standard user permissions.  

  [Just-in-time (JIT) and Just-enough administration (JEA)](https://docs.microsoft.com/en-us/azure/azure-australia/role-privileged): Managing who has administrative access to resources and services can be challenging and increase the attack vector for your organization.

  You may already be familiar with how to use [Role-based access control (RBAC)](https://docs.microsoft.com/en-us/azure/role-based-access-control/) for Azure resources. Once the appropriate roles have been configured, a typical scenario would either assign to those roles users who needed to perform administrative tasks – or you may create or maintain separate admin only accounts dedicated to this purpose. These request for access can be time limited, scoped to the roles you’ve setup with Azure, and sent through approval workflows before access is granted if necessary.

- Cloud app security broker (CAS-B): CAS-Bs are security policy enforcement points that allow you to monitor the cloud applications and services in use in your organization.  As users access cloud services, they can also be used to inject enterprise security policies.

  [Microsoft cloud app security (MCAS)](https://www.microsoft.com/en-us/microsoft-365/enterprise-mobility-security/cloud-app-security) is a CAS-B that works by using traffic logs to perform discovery and analyze which cloud apps are in use. Once identified, [policies can be created](https://docs.microsoft.com/en-us/cloud-app-security/control-cloud-apps-with-policies) to manage interaction with these apps or services, identify the applications as [sanctioned or unsanctioned](https://docs.microsoft.com/en-us/cloud-app-security/governance-discovery), [control and limit access to data](https://docs.microsoft.com/en-us/cloud-app-security/governance-actions), or [apply information protection](https://docs.microsoft.com/en-us/cloud-app-security/azip-integration) guard against information loss. 

  MCAS also works with [Azure AD conditional access](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal) allowing you to create access and session policies for your SaaS applications. [Access policies](https://docs.microsoft.com/en-us/cloud-app-security/access-policy-aad) allow you to strengthen control over which users have access to which cloud apps by doing things like [limiting the IP ranges that they can access services from](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/location-condition), [requiring MFA](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks) for some services, or [requiring activity be conducted from within an approved application](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/app-based-conditional-access), while [session policies](https://docs.microsoft.com/en-us/cloud-app-security/session-policy-aad) allow you to control what actions users can perform while logged in to these protected cloud apps. 

- Limiting access to [Exchange online](https://docs.microsoft.com/en-us/graph/auth-limit-mailbox-access), SharePoint online and OneDrive for Business content: The SharePoint admin center provides multiple ways that you can control access to your SharePoint and OneDrive content. Using the [access control page in the SharePoint admin center](https://admin.microsoft.com/sharepoint?page=accessControl&modern=true) you can choose to [completely block access from unmanaged devices](https://docs.microsoft.com/en-us/sharepoint/control-access-from-unmanaged-devices#block-access-using-the-new-sharepoint-admin-center), or you can [choose to allow limited , web-only access for these users](https://docs.microsoft.com/en-us/sharepoint/control-access-from-unmanaged-devices#limit-access-using-the-new-sharepoint-admin-center). Similar to managing access from managed and unmanaged devices you can also [control access to content based on network location](https://docs.microsoft.com/en-us/sharepoint/control-access-based-on-network-location). 

- [Terms of Use (TOU)](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/terms-of-use): Azure AD terms of use provides a way for you to present information to end users that they must consent to prior to gaining access to protected resources. Terms of Use documents are uploaded to Azure as PDF files and once added are available as controls in conditional access policies.

  By creating a conditional access policy that requires users to consent to terms of use at sign-in, you can easily audit which users accepted which terms of use.

7. [Real-time remediation](https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-remediate-unblock): If you allow users to self-remediate, with Azure MFA and SSPR in your risk policies, when risk is detected users can unblock themselves.

8. [Logs](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-activity-logs-azure-monitor): Microsoft provides you with multiple options to route Azure AD Sign-in logs and Audit logs to an endpoint like [Azure Monitor](https://azure.microsoft.com/en-us/services/monitor/) for long term retention and data insights (Azure Blob Storage, Azure Sentinel, and [other third-party options](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/stream-monitoring-data-event-hubs)). For risk detections, [there are APIs](https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-graph-api) that expose information about risky users and sign-ins via the Microsoft Graph API.  Azure AD documentation includes instructions to help you in setting up routing Azure AD logs to [ArcSight](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-arcsight), [Splunk](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-splunk) and [SumoLogic](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-sumologic) security information and events management (SIEM) solutions directly, with the following:

- Monitoring: [Azure Monitor](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-activity-logs-azure-monitor) allows you to route your Azure AD audit or sign-in logs to a variety of locations, including a storage account within Azure or your own Security information and Event management system using either [Azure Event Hubs](https://azure.microsoft.com/en-us/services/event-hubs/) to stream data back to your SIEM or by using the [Reporting Graph API](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-reporting-api) to retrieve and consume the data with your own scripts.

- Auditing: Azure AD provides [audit reporting](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-audit-logs) on sign-ins to managed applications and other Azure services, traceability of changes made in Azure, and risky sign-in and security logs. All this log data can be filtered and searched based on a variety of parameters including service, category, activity, and status.

9. [Endpoint management](https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/require-managed-devices): Authorized users can access your cloud apps from a broad range of devices including mobile and personal devices. If your environment has apps that should only be accessed by devices that meet your standards for security and compliance, you can restrict access using a Conditional Access policy. These devices are also known as managed devices and require [a device identity](https://docs.microsoft.com/en-us/azure/active-directory/devices/overview).

10.	[User/entity behavioral analytics (UEBA)](https://docs.microsoft.com/en-us/azure-advanced-threat-protection/what-is-atp): Azure Advanced Threat Protection (AATP) is a cloud-based security solution that leverages your on-premises Active Directory signals to identify, detect, and investigate advanced threats, compromised identities, and malicious insider actions directed at your organization. AATP focuses on learning patterns of user behavior to identify insider threats and flag risk. In this way, even if an identify becomes compromised, AATP can help identify that compromise based on unusual user behavior. 

    AATP can be [integrated with MCAS](https://docs.microsoft.com/en-us/azure-advanced-threat-protection/atp-mcas-integration) to extend protection to cloud apps, and with Azure AD identity protection to help protect identities being synchronized to Azure via AADConnect. You can also use MCAS to create session policies that do protect your files on download. For example, you might want to automatically set permissions on any file downloaded by specific types of users to view only. [Session control policies](https://docs.microsoft.com/en-us/cloud-app-security/session-policy-aad#protect-download) allow you to do this and more. 

11. SIEM: Routing your monitoring data to [Azure Sentinel](https://docs.microsoft.com/en-us/azure/sentinel/quickstart-onboard) or to an event hub with [Azure Monitor](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-activity-logs-azure-monitor) enables you to easily integrate with [external SIEM, monitoring and ITSM tools](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/stream-monitoring-data-event-hubs). 

    Each control or security feature discussed is part of the overall integrated and layered security approach in Azure AD. 
 ## Hybrid Considerations

- Hybrid authentication: While not represented in the above architecture, hybrid authentication methods are a key input to securing your organization’s identities. We provide [specific guidance](https://docs.microsoft.com/en-us/azure/security/fundamentals/choose-ad-authn) on choosing an authentication method with Azure AD.
- Access to on-premise applications: Using the Azure [Application Proxy](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/application-proxy) feature enables users to access on-premises web applications from a remote client. By using the application proxy functionality you can monitor all sign-in activity for your applications in one place, provide secure remote access to on-premise apps, and gain the ability to use Azure features like conditional access when users access these applications. 

   For some applications, you may already be using an [application delivery controller or network controller](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/secure-hybrid-access) to provide off-network access. Several vendors, including [Akamai](https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/akamai-tutorial), [Citrix](https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/citrix-netscaler-tutorial), [F5 Networks](https://aka.ms/f5-hybridaccessguide), and [Zscaler](https://aka.ms/zscaler-hybridaccessguide) offer solutions and guidance for integration with Azure AD to enable the above reference architecture. 

## Licensing 
Refer to [this page](https://azure.microsoft.com/en-us/pricing/details/active-directory/) for the most current information on any licensing questions.

## Next Steps 
- Learn more about the [concept of Zero Trust](https://www.microsoft.com/en-us/security/business/zero-trust) and how Microsoft can help. 
- Get additional [security architecture guidance](https://docs.microsoft.com/en-us/azure/architecture/framework/security/overview).  
- Develop your identity and security roadmap using [these tools](https://github.com/MarkSimos/MicrosoftSecurity/blob/master/Azure%20Security%20Compass%201.1/AzureSecurityCompassIndex.md). 
- Try out the Azure AD features in a [demo tenant](http://demos.microsoft.com/) (requires a Microsoft Partner Network account). Alternatively [sign up](https://www.microsoft.com/en-us/microsoft-365/enterprise-mobility-security) for a trial tenant. 
- Ready to deploy? Check out our [deployment plans](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-deployment-plans) for step-by-step guidance on some of the most common scenarios.

## Feedback

